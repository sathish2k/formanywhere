/* ═══════════════════════════════════════════════════════════════════════════════
   M3 SELECT — Based on material-components/material-web select-styles.css
   Mapped from Shadow DOM to flat class architecture
   ═══════════════════════════════════════════════════════════════════════════════ */

/* ─── ROOT (.md-select — maps to :host) ────────────────────────────────────── */

.md-select {
    display: inline-flex;
    flex-direction: column;
    position: relative;
    min-width: 210px;
    font-family: var(--m3-font-body, 'Inter', system-ui, sans-serif);
    text-align: start;
    -webkit-tap-highlight-color: transparent;

    /* ─── SIZE VARIANTS (custom extension) ─────────────────────────────────── */

    &.size-sm {
        .md-select__field { min-height: 40px; }
        .md-select__label { font-size: 14px; line-height: 20px; &.floating { top: 4px; font-size: 11px; line-height: 14px; } }
        .md-select__value { font-size: 14px; line-height: 20px; &.has-label { padding-top: 12px; } }
        .md-select__arrow { width: 20px; height: 20px; }
        .md-select__option { padding: 8px 12px; font-size: 14px; }
        .md-select__supporting { font-size: 11px; padding-left: 12px; }

        &.filled .md-select__field { padding: 4px 12px; }
        &.outlined .md-select__field { padding: 0 12px; }
        &.outlined.focused .md-select__field { padding: 0 11px; }
    }

    &.size-md {
        /* Default — no overrides needed */
    }

    &.size-lg {
        .md-select__field { min-height: 64px; }
        .md-select__label { font-size: 18px; line-height: 28px; &.floating { top: 10px; font-size: 12px; line-height: 16px; } }
        .md-select__value { font-size: 18px; line-height: 28px; &.has-label { padding-top: 20px; } }
        .md-select__arrow { width: 28px; height: 28px; }
        .md-select__option { padding: 14px 20px; font-size: 18px; }
        .md-select__supporting { font-size: 13px; padding-left: 20px; }

        &.filled .md-select__field { padding: 10px 20px; }
        &.outlined .md-select__field { padding: 0 20px; }
        &.outlined.focused .md-select__field { padding: 0 19px; }
    }

    /* ─── DISABLED (maps to :host([disabled])) ──────────────────────────────── */

    &.disabled {
        pointer-events: none;

        .md-select__field {
            cursor: default;
        }

        .md-select__label {
            color: var(--m3-color-on-surface, #1d1b20);
            opacity: 0.38;
        }

        .md-select__value {
            color: var(--m3-color-on-surface, #1d1b20);
            opacity: 0.38;
        }

        .md-select__arrow {
            fill: var(--m3-color-on-surface, #1d1b20);
            opacity: 0.38;
        }

        .md-select__supporting {
            color: var(--m3-color-on-surface, #1d1b20);
            opacity: 0.38;
        }
    }

    /* ─── FILLED VARIANT ────────────────────────────────────────────────────── */

    &.filled {
        .md-select__field {
            padding: 8px 16px;
            background: var(--m3-color-surface-container-highest, #e6e0e9);
            border: none;
            border-bottom: 1px solid var(--m3-color-on-surface-variant, #49454f);
            border-radius: var(--m3-shape-extra-small, 4px) var(--m3-shape-extra-small, 4px) 0 0;
        }

        &:not(.disabled):hover .md-select__field {
            background: color-mix(in srgb, var(--m3-color-on-surface, #1d1b20) 8%, var(--m3-color-surface-container-highest, #e6e0e9));
            border-bottom-color: var(--m3-color-on-surface, #1d1b20);
        }

        &.focused .md-select__field {
            border-bottom-width: 3px;
            border-bottom-color: var(--m3-color-primary, #6750a4);
        }

        &.error .md-select__field {
            border-bottom-color: var(--m3-color-error, #b3261e);
        }

        &.error.focused .md-select__field {
            border-bottom-color: var(--m3-color-error, #b3261e);
        }

        &.error:not(.disabled):hover .md-select__field {
            border-bottom-color: var(--m3-color-on-error-container, #410e0b);
        }

        /* Filled disabled overrides */
        &.disabled .md-select__field {
            background: color-mix(in srgb, var(--m3-color-on-surface, #1d1b20) 4%, transparent);
            border-bottom-color: var(--m3-color-on-surface, #1d1b20);
            border-bottom-style: solid;
            border-bottom-width: 1px;

            &::after {
                content: '';
                position: absolute;
                inset: 0;
                border-bottom: 1px solid var(--m3-color-on-surface, #1d1b20);
                opacity: 0.38;
            }
        }
    }

    /* ─── OUTLINED VARIANT ──────────────────────────────────────────────────── */

    &.outlined {
        .md-select__field {
            padding: 0 16px;
            background: transparent;
            border: 1px solid var(--m3-color-outline, #79747e);
            border-radius: var(--m3-shape-extra-small, 4px);
        }

        &:not(.disabled):hover .md-select__field {
            border-color: var(--m3-color-on-surface, #1d1b20);
        }

        &.focused .md-select__field {
            border-width: 3px;
            border-color: var(--m3-color-primary, #6750a4);
            padding: 0 14px; /* compensate for thicker border */
        }

        &.error .md-select__field {
            border-color: var(--m3-color-error, #b3261e);
        }

        &.error.focused .md-select__field {
            border-color: var(--m3-color-error, #b3261e);
        }

        &.error:not(.disabled):hover .md-select__field {
            border-color: var(--m3-color-on-error-container, #410e0b);
        }

        /* Outlined disabled overrides */
        &.disabled .md-select__field {
            border-color: var(--m3-color-on-surface, #1d1b20);
            border-width: 1px;
            opacity: 1; /* opacity handled per-child */

            &::after {
                content: '';
                position: absolute;
                inset: 0;
                border: 1px solid var(--m3-color-on-surface, #1d1b20);
                border-radius: inherit;
                opacity: 0.12;
            }
        }
    }

    /* ─── FOCUS RING ────────────────────────────────────────────────────────── */

    &.focused .md-select__field:focus-visible {
        outline: 3px solid var(--m3-color-secondary, #625b71);
        outline-offset: 2px;
    }

    /* ─── LABEL STATE COLORS ────────────────────────────────────────────────── */

    &:not(.disabled):hover .md-select__label {
        color: var(--m3-color-on-surface, #1d1b20);
    }

    &.focused .md-select__label {
        color: var(--m3-color-primary, #6750a4);
    }

    &.error .md-select__label {
        color: var(--m3-color-error, #b3261e);
    }

    &.error.focused .md-select__label {
        color: var(--m3-color-error, #b3261e);
    }

    &.error:not(.disabled):hover .md-select__label {
        color: var(--m3-color-on-error-container, #410e0b);
    }

    /* ─── ARROW STATE COLORS ────────────────────────────────────────────────── */

    &:not(.disabled):hover .md-select__arrow {
        fill: var(--m3-color-on-surface-variant, #49454f);
    }

    &.focused .md-select__arrow {
        fill: var(--m3-color-primary, #6750a4);
    }

    &.error .md-select__arrow {
        fill: var(--m3-color-error, #b3261e);
    }

    &.error.focused .md-select__arrow {
        fill: var(--m3-color-error, #b3261e);
    }

    &.error:not(.disabled):hover .md-select__arrow {
        fill: var(--m3-color-on-error-container, #410e0b);
    }

    /* ─── SUPPORTING TEXT STATE COLORS ───────────────────────────────────────── */

    &.error .md-select__supporting {
        color: var(--m3-color-error, #b3261e);
    }

    &.error.focused .md-select__supporting {
        color: var(--m3-color-error, #b3261e);
    }

    &.error:not(.disabled):hover .md-select__supporting {
        color: var(--m3-color-error, #b3261e);
    }

    /* ─── OPEN STATE ────────────────────────────────────────────────────────── */

    &.open {
        .md-select__arrow {
            transform: rotate(180deg);
        }

        .md-select__menu {
            max-height: 256px;
            opacity: 1;
            box-shadow: var(--m3-elevation-2, 0 1px 2px 0 rgba(0, 0, 0, 0.3), 0 2px 6px 2px rgba(0, 0, 0, 0.15));
        }
    }

    /* ─── LIQUID GLASS VARIANT (custom extension) ──────────────────────────── */

    &.glass {
        .md-select__field {
            background: var(--glass-tint, rgba(255, 255, 255, 0.45));
            backdrop-filter: blur(var(--glass-blur, 20px));
            -webkit-backdrop-filter: blur(var(--glass-blur, 20px));
            border: 1px solid var(--glass-border, rgba(255, 255, 255, 0.3));
            border-radius: var(--m3-shape-medium, 12px);
        }

        &.focused .md-select__field {
            border-color: var(--m3-color-primary, #6750a4);
            border-width: 2px;
        }

        .md-select__menu {
            background: var(--glass-tint, rgba(255, 255, 255, 0.75));
            backdrop-filter: blur(var(--glass-blur, 20px));
            -webkit-backdrop-filter: blur(var(--glass-blur, 20px));
            border: 1px solid var(--glass-border, rgba(255, 255, 255, 0.3));
            border-radius: 0 0 var(--m3-shape-medium, 12px) var(--m3-shape-medium, 12px);
        }

        .md-select__option:hover {
            background: var(--glass-hover, rgba(255, 255, 255, 0.2));
        }
    }
}

/* ─── FIELD ────────────────────────────────────────────────────────────────── */

.md-select__field {
    position: relative;
    display: flex;
    align-items: center;
    min-height: 56px;
    cursor: default;
    outline: none;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    transition: border-color 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                border-width 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                background 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1));
}

/* ─── LABEL ────────────────────────────────────────────────────────────────── */

.md-select__label {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: var(--m3-typescale-body-large-size, 1rem);
    line-height: var(--m3-typescale-body-large-line-height, 1.5rem);
    font-weight: var(--m3-typescale-body-large-weight, 400);
    font-family: var(--m3-font-body, 'Inter', system-ui, sans-serif);
    color: var(--m3-color-on-surface-variant, #49454f);
    pointer-events: none;
    max-width: calc(100% - 56px); /* leave room for arrow */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    transition: top 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                transform 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                font-size 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                line-height 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                color 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1));

    &.floating {
        top: 8px;
        transform: translateY(0);
        font-size: var(--m3-typescale-body-small-size, 0.75rem);
        line-height: var(--m3-typescale-body-small-line-height, 1rem);
    }
}

/* ─── VALUE ────────────────────────────────────────────────────────────────── */

.md-select__value {
    flex: 1;
    font-size: var(--m3-typescale-body-large-size, 1rem);
    line-height: var(--m3-typescale-body-large-line-height, 1.5rem);
    font-weight: var(--m3-typescale-body-large-weight, 400);
    font-family: var(--m3-font-body, 'Inter', system-ui, sans-serif);
    color: var(--m3-color-on-surface, #1d1b20);
    min-height: 24px;
    display: flex;
    align-items: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;

    &.has-label {
        padding-top: 16px;
    }

    &.placeholder {
        color: var(--m3-color-on-surface-variant, #49454f);
    }

    /* Hide placeholder when label is resting (not floating) to prevent overlap */
    &.placeholder.has-label.label-resting {
        visibility: hidden;
    }
}

/* ─── ARROW / TRAILING ICON ────────────────────────────────────────────────── */

.md-select__arrow {
    width: 24px;
    height: 24px;
    fill: var(--m3-color-on-surface-variant, #49454f);
    flex-shrink: 0;
    margin-inline-start: 4px;
    transition: transform 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                fill 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1));
}

/* ─── DROPDOWN MENU ────────────────────────────────────────────────────────── */

.md-select__menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    max-height: 0;
    overflow-y: auto;
    background: var(--m3-color-surface-container, #f3edf7);
    border-radius: 0 0 var(--m3-shape-extra-small, 4px) var(--m3-shape-extra-small, 4px);
    box-shadow: none;
    opacity: 0;
    z-index: 100;
    transition: max-height 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                opacity 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1)),
                box-shadow 150ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1));
}

/* ─── OPTION ───────────────────────────────────────────────────────────────── */

.md-select__option {
    position: relative;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    min-height: 48px;
    cursor: default;
    font-size: var(--m3-typescale-body-large-size, 1rem);
    line-height: var(--m3-typescale-body-large-line-height, 1.5rem);
    font-family: var(--m3-font-body, 'Inter', system-ui, sans-serif);
    color: var(--m3-color-on-surface, #1d1b20);
    overflow: hidden;
    transition: background 100ms var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1));

    /* M3 state layer: hover = 0.08 */
    &:hover {
        background: color-mix(in srgb, var(--m3-color-on-surface, #1d1b20) 8%, transparent);
    }

    /* M3 state layer: focus = 0.12 */
    &.highlighted {
        background: color-mix(in srgb, var(--m3-color-on-surface, #1d1b20) 12%, transparent);
    }

    /* M3 state layer: pressed = 0.12 */
    &:active {
        background: color-mix(in srgb, var(--m3-color-on-surface, #1d1b20) 12%, transparent);
    }

    &.selected {
        background: var(--m3-color-secondary-container, #e8def8);
        color: var(--m3-color-on-secondary-container, #1d192b);
    }

    &.option-disabled {
        cursor: default;
        opacity: 0.38;
        pointer-events: none;
    }
}

.md-select__option-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
    min-width: 0;
}

.md-select__option-supporting {
    font-size: var(--m3-typescale-body-small-size, 0.75rem);
    line-height: var(--m3-typescale-body-small-line-height, 1rem);
    color: var(--m3-color-on-surface-variant, #49454f);
}

.md-select__option-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    color: var(--m3-color-on-surface-variant, #49454f);
    fill: currentColor;
}

/* ─── SUPPORTING TEXT ──────────────────────────────────────────────────────── */

.md-select__supporting {
    font-size: var(--m3-typescale-body-small-size, 0.75rem);
    line-height: var(--m3-typescale-body-small-line-height, 1rem);
    font-weight: var(--m3-typescale-body-small-weight, 400);
    font-family: var(--m3-font-body, 'Inter', system-ui, sans-serif);
    color: var(--m3-color-on-surface-variant, #49454f);
    margin-top: 4px;
    padding-left: 16px;
    display: block;
}

/* ─── FORCED COLORS ACCESSIBILITY ──────────────────────────────────────────── */

@media (forced-colors: active) {
    .md-select.filled .md-select__field {
        border-bottom-color: CanvasText;
        background: Canvas;
    }

    .md-select.outlined .md-select__field {
        border-color: CanvasText;
    }

    .md-select.focused .md-select__field {
        border-color: Highlight;
    }

    .md-select.disabled .md-select__field {
        border-color: GrayText;
    }

    .md-select.disabled .md-select__label,
    .md-select.disabled .md-select__value,
    .md-select.disabled .md-select__arrow {
        color: GrayText;
        fill: GrayText;
        opacity: 1;
    }

    .md-select__arrow {
        fill: CanvasText;
    }

    .md-select__menu {
        border: 1px solid CanvasText;
        background: Canvas;
    }

    .md-select__option.selected {
        background: Highlight;
        color: HighlightText;
    }

    .md-select__option.highlighted {
        outline: 1px solid Highlight;
    }
}
