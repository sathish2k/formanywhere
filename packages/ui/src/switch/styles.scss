/* ═══════════════════════════════════════════════════════════════════════════════
   M3 SWITCH — Based on material-components/material-web switch-styles.css
   Mapped from Shadow DOM to flat class architecture
   ═══════════════════════════════════════════════════════════════════════════════ */

/* ─── ROOT (maps to :host + .switch) ───────────────────────────────────────── */

.md-switch {
    display: inline-flex;
    align-items: center;
    outline: none;
    vertical-align: top;
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
    border: none;
    background: none;
    padding: 0;
    position: relative;

    /* Touch target */
    &::after {
        content: '';
        position: absolute;
        width: max(100%, var(--md-switch-touch-target-size, 48px));
        height: max(100%, var(--md-switch-touch-target-size, 48px));
        inset: 50%;
        transform: translate(-50%, -50%);
    }

    /* ─── DISABLED (maps to :host([disabled])) ──────────────────────────────── */

    &.disabled {
        cursor: default;
        pointer-events: none;

        .md-switch__track {
            background-color: transparent;
            border-color: transparent;

            &::before {
                transition: none;
                opacity: var(--md-switch-disabled-track-opacity, 0.12);
            }
        }

        .md-switch__handle {
            transition: none;

            &::before {
                transition: none;
            }
        }
    }

    /* ─── WITH-ICON handle growth (M3: unselected handle grows to 24px) ────── */

    &.icons:not(.checked):not(.show-only-selected-icon) {
        .md-switch__handle {
            width: 24px;
            height: 24px;
            inset-inline-start: 4px; /* Center at 16px: 4 + 24/2 = 16 */
        }
    }

    /* ─── UNSELECTED STATE ─────────────────────────────────────────────────── */

    &:not(.checked) {
        .md-switch__track::before {
            background-color: var(--md-switch-track-color, var(--m3-color-surface-container-highest, #e6e0e9));
            border-color: var(--md-switch-track-outline-color, var(--m3-color-outline, #79747e));
            border-style: solid;
            border-width: var(--md-switch-track-outline-width, 2px);
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-handle-color, var(--m3-color-outline, #79747e));
        }

        .md-switch__icon {
            color: var(--md-switch-icon-color, var(--m3-color-surface-container-highest, #e6e0e9));
        }
    }

    &:hover:not(.disabled):not(.checked) {
        .md-switch__track::before {
            background-color: var(--md-switch-hover-track-color, var(--m3-color-surface-container-highest, #e6e0e9));
            border-color: var(--md-switch-hover-track-outline-color, var(--m3-color-outline, #79747e));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-hover-handle-color, var(--m3-color-on-surface-variant, #49454f));
        }

        .md-switch__icon {
            color: var(--md-switch-hover-icon-color, var(--m3-color-surface-container-highest, #e6e0e9));
        }
    }

    &:focus-within:not(.disabled):not(.checked) {
        .md-switch__track::before {
            background-color: var(--md-switch-focus-track-color, var(--m3-color-surface-container-highest, #e6e0e9));
            border-color: var(--md-switch-focus-track-outline-color, var(--m3-color-outline, #79747e));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-focus-handle-color, var(--m3-color-on-surface-variant, #49454f));
        }

        .md-switch__icon {
            color: var(--md-switch-focus-icon-color, var(--m3-color-surface-container-highest, #e6e0e9));
        }
    }

    &:active:not(.disabled):not(.checked) {
        .md-switch__track::before {
            background-color: var(--md-switch-pressed-track-color, var(--m3-color-surface-container-highest, #e6e0e9));
            border-color: var(--md-switch-pressed-track-outline-color, var(--m3-color-outline, #79747e));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-pressed-handle-color, var(--m3-color-on-surface-variant, #49454f));
        }

        .md-switch__icon {
            color: var(--md-switch-pressed-icon-color, var(--m3-color-surface-container-highest, #e6e0e9));
        }

        .md-switch__handle {
            width: var(--md-switch-pressed-handle-width, 28px);
            height: var(--md-switch-pressed-handle-height, 28px);
            inset-inline-start: 4px; /* Keep center stable: (52 - 28) / 2 - 2 = 10...actually want center at 16px: 16 - 14 = 2 + 2px border = 4px */
            transition-timing-function: linear;
            transition-duration: 100ms;
        }
    }

    &.disabled:not(.checked) {
        .md-switch__track::before {
            background-color: var(--md-switch-disabled-track-color, var(--m3-color-surface-container-highest, #e6e0e9));
            border-color: var(--md-switch-disabled-track-outline-color, var(--m3-color-on-surface, #1d1b20));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-disabled-handle-color, var(--m3-color-on-surface, #1d1b20));
            opacity: var(--md-switch-disabled-handle-opacity, 0.38);
        }

        .md-switch__icon {
            color: var(--md-switch-disabled-icon-color, var(--m3-color-surface-container-highest, #e6e0e9));
            opacity: var(--md-switch-disabled-icon-opacity, 0.38);
        }
    }

    /* ─── SELECTED STATE ───────────────────────────────────────────────────── */

    &.checked {
        .md-switch__track::before {
            background-color: var(--md-switch-selected-track-color, var(--m3-color-primary, #6750a4));
        }

        .md-switch__handle {
            width: var(--md-switch-selected-handle-width, 24px);
            height: var(--md-switch-selected-handle-height, 24px);
            inset-inline-start: calc(100% - 28px);

            &::before {
                background-color: var(--md-switch-selected-handle-color, var(--m3-color-on-primary, #fff));
            }
        }

        .md-switch__icon {
            color: var(--md-switch-selected-icon-color, var(--m3-color-on-primary-container, #21005d));
        }
    }

    &.checked:hover:not(.disabled) {
        .md-switch__track::before {
            background-color: var(--md-switch-selected-hover-track-color, var(--m3-color-primary, #6750a4));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-selected-hover-handle-color, var(--m3-color-primary-container, #eaddff));
        }

        .md-switch__icon {
            color: var(--md-switch-selected-hover-icon-color, var(--m3-color-on-primary-container, #21005d));
        }
    }

    &.checked:focus-within:not(.disabled) {
        .md-switch__track::before {
            background-color: var(--md-switch-selected-focus-track-color, var(--m3-color-primary, #6750a4));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-selected-focus-handle-color, var(--m3-color-primary-container, #eaddff));
        }

        .md-switch__icon {
            color: var(--md-switch-selected-focus-icon-color, var(--m3-color-on-primary-container, #21005d));
        }
    }

    &.checked:active:not(.disabled) {
        .md-switch__track::before {
            background-color: var(--md-switch-selected-pressed-track-color, var(--m3-color-primary, #6750a4));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-selected-pressed-handle-color, var(--m3-color-primary-container, #eaddff));
        }

        .md-switch__icon {
            color: var(--md-switch-selected-pressed-icon-color, var(--m3-color-on-primary-container, #21005d));
        }

        .md-switch__handle {
            width: var(--md-switch-pressed-handle-width, 28px);
            height: var(--md-switch-pressed-handle-height, 28px);
            inset-inline-start: calc(100% - 32px);
            transition-timing-function: linear;
            transition-duration: 100ms;
        }
    }

    &.checked.disabled {
        .md-switch__track::before {
            background-color: var(--md-switch-disabled-selected-track-color, var(--m3-color-on-surface, #1d1b20));
        }

        .md-switch__handle::before {
            background-color: var(--md-switch-disabled-selected-handle-color, var(--m3-color-surface, #fef7ff));
            opacity: var(--md-switch-disabled-selected-handle-opacity, 1);
        }

        .md-switch__icon {
            color: var(--md-switch-disabled-selected-icon-color, var(--m3-color-on-surface, #1d1b20));
            opacity: var(--md-switch-disabled-selected-icon-opacity, 0.38);
        }
    }

    /* ─── FOCUS RING ───────────────────────────────────────────────────────── */

    &:focus-visible {
        outline: 3px solid var(--m3-color-secondary, #625b71);
        outline-offset: 2px;
        border-radius: var(--md-switch-track-shape, var(--m3-shape-corner-full, 9999px));
    }

    /* ─── LIQUID GLASS VARIANT (custom extension) ──────────────────────────── */

    &.glass {
        .md-switch__track {
            background: var(--glass-tint, rgba(255, 255, 255, 0.35));
            backdrop-filter: blur(var(--glass-blur, 16px));
            -webkit-backdrop-filter: blur(var(--glass-blur, 16px));
            border-color: var(--glass-border, rgba(255, 255, 255, 0.3));
        }

        &.checked .md-switch__track {
            background: var(--m3-color-primary, rgba(103, 80, 164, 0.8));
            border-color: transparent;
        }

        .md-switch__handle::before {
            background: var(--glass-on-surface, rgba(255, 255, 255, 0.85));
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
        }

        &.checked .md-switch__handle::before {
            background: var(--m3-color-on-primary, rgba(255, 255, 255, 0.95));
        }
    }
}

/* ─── TRACK (maps to .track) ───────────────────────────────────────────────── */

.md-switch__track {
    position: relative;
    width: var(--md-switch-track-width, 52px);
    height: var(--md-switch-track-height, 32px);
    box-sizing: border-box;
    border-radius: var(--md-switch-track-shape, var(--m3-shape-corner-full, 9999px));
    display: flex;
    justify-content: center;
    align-items: center;

    &::before {
        content: '';
        display: flex;
        position: absolute;
        height: 100%;
        width: 100%;
        border-radius: inherit;
        box-sizing: border-box;
        transition-property: opacity, background-color;
        transition-timing-function: linear;
        transition-duration: 67ms;
    }
}

/* ─── HANDLE (maps to .handle-container + .handle) ─────────────────────────── */

.md-switch__handle {
    position: absolute;
    top: 50%;
    inset-inline-start: 8px;
    transform: translateY(-50%);
    display: flex;
    place-content: center;
    place-items: center;
    width: var(--md-switch-handle-width, 16px);
    height: var(--md-switch-handle-height, 16px);
    z-index: 0;
    /* Handle position: spring overshoot easing at 300ms (M3 handle-container margin) */
    transition-property: width, height, inset-inline-start;
    transition-duration: 250ms, 250ms, 300ms;
    transition-timing-function: cubic-bezier(0.2, 0, 0, 1), cubic-bezier(0.2, 0, 0, 1), cubic-bezier(0.175, 0.885, 0.32, 1.275);

    /* Handle visual (maps to .handle) */
    &::before {
        content: '';
        display: flex;
        inset: 0;
        position: absolute;
        border-radius: var(--md-switch-handle-shape, var(--m3-shape-corner-full, 9999px));
        box-sizing: border-box;
        transition: background-color 67ms linear;
    }

    /* State layer — 40px circle centered on handle */
    &::after {
        content: '';
        position: absolute;
        width: var(--md-switch-state-layer-size, 40px);
        height: var(--md-switch-state-layer-size, 40px);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: var(--m3-shape-corner-full, 9999px);
        background-color: transparent;
        transition: background-color 15ms linear;
        pointer-events: none;
    }
}

/* ─── State layer feedback on handle ───────────────────────────────────────── */

.md-switch:hover:not(.disabled):not(.checked) .md-switch__handle::after {
    background-color: color-mix(in srgb, var(--m3-color-on-surface, #1d1b20) 8%, transparent);
}

.md-switch:active:not(.disabled):not(.checked) .md-switch__handle::after {
    background-color: color-mix(in srgb, var(--m3-color-on-surface, #1d1b20) 12%, transparent);
}

.md-switch.checked:hover:not(.disabled) .md-switch__handle::after {
    background-color: color-mix(in srgb, var(--m3-color-primary, #6750a4) 8%, transparent);
}

.md-switch.checked:active:not(.disabled) .md-switch__handle::after {
    background-color: color-mix(in srgb, var(--m3-color-primary, #6750a4) 12%, transparent);
}

/* ─── ICON (maps to .icon) ─────────────────────────────────────────────────── */

.md-switch__icon {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    fill: currentColor;
    transition: fill 67ms linear, opacity 33ms linear, transform 167ms cubic-bezier(0.2, 0, 0, 1);
    opacity: 0;
    width: var(--md-switch-icon-size, 16px);
    height: var(--md-switch-icon-size, 16px);
}

.md-switch.disabled .md-switch__icon {
    transition: none;
}

/* Show selected icon when checked, unselected icon when not */
.md-switch.checked .md-switch__icon {
    opacity: 1;
}

.md-switch:not(.checked) .md-switch__icon {
    opacity: 1;
}

/* ─── FORCED COLORS ACCESSIBILITY ──────────────────────────────────────────── */

@media (forced-colors: active) {
    .md-switch.checked .md-switch__track::before {
        background: ButtonText;
        border-color: ButtonText;
    }

    .md-switch.disabled .md-switch__track::before {
        border-color: GrayText;
        opacity: 1;
    }

    .md-switch.disabled.checked .md-switch__track::before {
        background: GrayText;
    }

    .md-switch:not(.checked) .md-switch__handle::before {
        background: ButtonText;
    }

    .md-switch.disabled .md-switch__handle::before {
        opacity: 1;
    }

    .md-switch.disabled:not(.checked) .md-switch__handle::before {
        background: GrayText;
    }
}

/* ─── SMALL SIZE VARIANT (custom extension) ────────────────────────────────── */

.md-switch--sm {
    .md-switch__track {
        width: 36px;
        height: 20px;
        border-radius: 10px;
    }

    .md-switch__track::before {
        border-width: 1.5px;
    }

    .md-switch__handle {
        width: 12px;
        height: 12px;
        inset-inline-start: 4px;
    }

    &.checked .md-switch__handle {
        width: 16px;
        height: 16px;
        inset-inline-start: calc(100% - 18px);
    }

    &:active:not(.disabled):not(.checked) .md-switch__handle {
        width: 14px;
        height: 14px;
        inset-inline-start: 3px;
    }

    .md-switch__icon {
        width: 10px;
        height: 10px;
    }
}