/* ═══════════════════════════════════════════════════════════════════════════════
   M3 TEXTFIELD — Based on material-components/material-web compiled CSS
   Flat CSS classes (no Shadow DOM). See index.tsx for class mapping.
   ═══════════════════════════════════════════════════════════════════════════════ */

// ─── Motion ──────────────────────────────────────────────────────────────────
$_easing: var(--m3-motion-easing-standard, cubic-bezier(0.2, 0, 0, 1));
$_duration: 150ms;

// ─── Autofill detection keyframes ────────────────────────────────────────────
@keyframes md-tf-autofill-start { from {} to {} }
@keyframes md-tf-autofill-cancel { from {} to {} }

// ═════════════════════════════════════════════════════════════════════════════
// ROOT
// ═════════════════════════════════════════════════════════════════════════════
.md-textfield {
    display: inline-flex;
    flex-direction: column;
    min-width: 210px;
    font-family: var(--m3-font-body, 'Inter', system-ui, sans-serif);
    position: relative;
    text-align: start;
    -webkit-tap-highlight-color: transparent;
    width: 100%;
    outline: none;
    resize: both;

    // ─── SIZE VARIANTS ───────────────────────────────────────────────────────
    &.size-sm {
        .md-tf-field { min-height: 40px; }
        .md-tf-content { min-height: 40px; padding: 0 12px; }
        .md-tf-input { font-size: 14px; line-height: 20px; }
        .md-tf-label-outlined { font-size: 14px; line-height: 20px; }
        .md-tf-label-filled { font-size: 14px; line-height: 20px; }
        .md-tf-icon {
            width: 20px; height: 20px;
            &.leading { margin-inline-end: 8px; }
            &.trailing { margin-inline-start: 8px; }
        }
        .md-tf-supporting { font-size: 11px; padding: 2px 12px 0; }

        &.focused .md-tf-label-outlined,
        &.populated .md-tf-label-outlined {
            font-size: 11px; line-height: 14px; transform: translateY(-22px);
        }
        &.focused .md-tf-label-filled,
        &.populated .md-tf-label-filled {
            top: 4px; font-size: 11px; line-height: 14px;
        }
        &.has-label.filled .md-tf-content { padding-top: 4px; }
        &.has-label.filled .md-tf-input { padding-top: 12px; }
    }

    &.size-md { /* default — no overrides */ }

    &.size-lg {
        .md-tf-field { min-height: 64px; }
        .md-tf-content { min-height: 64px; padding: 0 20px; }
        .md-tf-input { font-size: 18px; line-height: 28px; }
        .md-tf-label-outlined { font-size: 18px; line-height: 28px; }
        .md-tf-label-filled { font-size: 18px; line-height: 28px; }
        .md-tf-icon {
            width: 28px; height: 28px;
            &.leading { margin-inline-end: 16px; }
            &.trailing { margin-inline-start: 16px; }
        }
        .md-tf-supporting { font-size: 13px; padding: 4px 20px 0; }

        &.focused .md-tf-label-outlined,
        &.populated .md-tf-label-outlined {
            font-size: 12px; line-height: 16px; transform: translateY(-32px);
        }
        &.focused .md-tf-label-filled,
        &.populated .md-tf-label-filled {
            top: 10px; font-size: 12px; line-height: 16px;
        }
        &.has-label.filled .md-tf-content { padding-top: 10px; }
        &.has-label.filled .md-tf-input { padding-top: 20px; }
    }

    // ─── DISABLED ────────────────────────────────────────────────────────────
    &.disabled {
        pointer-events: none;

        .md-tf-field { cursor: default; }
        .md-tf-icon { opacity: 0.38; }
        .md-tf-supporting { opacity: 0.38; }
    }

    // ─── ERROR (shared) ──────────────────────────────────────────────────────
    &.error {
        .md-tf-input {
            caret-color: var(--m3-color-error, #b3261e);
        }

        .md-tf-icon.trailing {
            color: var(--m3-color-error, #b3261e);
        }

        .md-tf-supporting .md-tf-supporting-text {
            color: var(--m3-color-error, #b3261e);
        }

        // Error + hover label & indicator colors
        &:not(.focused):not(.disabled) .md-tf-field:hover {
            .md-tf-label-filled,
            .md-tf-label-outlined {
                color: var(--m3-color-on-error-container, #410e0b);
            }
        }
    }

    // ─── NO SPINNER ──────────────────────────────────────────────────────────
    &.no-spinner {
        .md-tf-input::-webkit-inner-spin-button,
        .md-tf-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .md-tf-input[type="number"] {
            -moz-appearance: textfield;
        }
    }

    // ─── PLACEHOLDER VISIBILITY ──────────────────────────────────────────────
    // M3 reference shows placeholder at all times.
    // Only hide when a floating label is visible and field is not focused/populated.
    &.has-label:not(.focused):not(.populated) .md-tf-input::placeholder {
        color: transparent;
    }

    // ─── PREFIX / SUFFIX visibility on focus / populated ─────────────────────
    &.focused,
    &.populated {
        .md-tf-prefix,
        .md-tf-suffix {
            opacity: 1;
        }
    }

    // ═════════════════════════════════════════════════════════════════════════
    // OUTLINED VARIANT
    // ═════════════════════════════════════════════════════════════════════════
    &.outlined {
        .md-tf-field {
            border-radius: var(--m3-shape-extra-small, 4px);
        }

        // Hover (non-error, non-disabled, non-focused)
        &:not(.disabled):not(.error):not(.focused) .md-tf-field:hover {
            .md-tf-outline-start,
            .md-tf-outline-notch,
            .md-tf-outline-end {
                border-color: var(--m3-color-on-surface, #1d1b20);
            }
            .md-tf-label-outlined {
                color: var(--m3-color-on-surface, #1d1b20);
            }
        }

        // Focused — 3px border per M3 spec
        &.focused {
            .md-tf-outline-start {
                border-left-width: 3px;
                border-top-width: 3px;
                border-bottom-width: 3px;
                border-color: var(--m3-color-primary, #6750a4);
            }
            .md-tf-outline-notch {
                border-top: none;
                border-bottom-width: 3px;
                border-bottom-color: var(--m3-color-primary, #6750a4);
            }
            .md-tf-outline-end {
                border-right-width: 3px;
                border-top-width: 3px;
                border-bottom-width: 3px;
                border-color: var(--m3-color-primary, #6750a4);
            }
            .md-tf-label-outlined {
                font-size: 12px;
                line-height: 16px;
                transform: translateY(-28px);
                color: var(--m3-color-primary, #6750a4);
            }
        }

        // Populated (notch open)
        &.populated {
            .md-tf-outline-notch { border-top: none; }
            .md-tf-label-outlined {
                font-size: 12px;
                line-height: 16px;
                transform: translateY(-28px);
            }
        }

        // Error
        &.error {
            .md-tf-outline-start,
            .md-tf-outline-notch,
            .md-tf-outline-end {
                border-color: var(--m3-color-error, #b3261e);
            }
            .md-tf-label-outlined {
                color: var(--m3-color-error, #b3261e);
            }

            // Error + hover
            &:not(.focused):not(.disabled) .md-tf-field:hover {
                .md-tf-outline-start,
                .md-tf-outline-notch,
                .md-tf-outline-end {
                    border-color: var(--m3-color-on-error-container, #410e0b);
                }
            }

            // Error + focused
            &.focused {
                .md-tf-outline-start {
                    border-color: var(--m3-color-error, #b3261e);
                }
                .md-tf-outline-notch {
                    border-bottom-color: var(--m3-color-error, #b3261e);
                }
                .md-tf-outline-end {
                    border-color: var(--m3-color-error, #b3261e);
                }
                .md-tf-label-outlined {
                    color: var(--m3-color-error, #b3261e);
                }
            }
        }

        // Disabled
        &.disabled {
            .md-tf-outline-start,
            .md-tf-outline-notch,
            .md-tf-outline-end {
                border-color: var(--m3-color-on-surface, #1d1b20);
                opacity: 0.12;
            }
            .md-tf-label-outlined {
                color: var(--m3-color-on-surface, #1d1b20);
                opacity: 0.38;
            }
        }
    }

    // ═════════════════════════════════════════════════════════════════════════
    // FILLED VARIANT
    // ═════════════════════════════════════════════════════════════════════════
    &.filled {
        .md-tf-field {
            border-radius: var(--m3-shape-extra-small, 4px) var(--m3-shape-extra-small, 4px) 0 0;
            background: var(--m3-color-surface-container-highest, #e6e0e9);
            overflow: hidden;
        }

        // Disabled
        &.disabled .md-tf-field {
            background: rgba(var(--m3-color-on-surface-rgb, 29, 27, 32), 0.04);
        }

        // Hover (non-error, non-disabled, non-focused)
        &:not(.disabled):not(.error):not(.focused) .md-tf-field:hover {
            .md-tf-active-indicator {
                background: var(--m3-color-on-surface, #1d1b20);
            }
            .md-tf-label-filled {
                color: var(--m3-color-on-surface-variant, #49454f);
            }
        }

        // State layer hover
        &:not(.disabled) .md-tf-field:hover .md-tf-state-layer {
            opacity: 0.08;
        }

        // Focused — 3px thick indicator per M3 spec
        &.focused {
            .md-tf-active-indicator {
                height: 3px;
                background: var(--m3-color-primary, #6750a4);
            }
            .md-tf-label-filled {
                top: 8px;
                transform: translateY(0);
                font-size: 12px;
                line-height: 16px;
                color: var(--m3-color-primary, #6750a4);
            }
        }

        // Populated
        &.populated .md-tf-label-filled {
            top: 8px;
            transform: translateY(0);
            font-size: 12px;
            line-height: 16px;
        }

        // Error
        &.error {
            .md-tf-active-indicator {
                background: var(--m3-color-error, #b3261e);
            }
            &.focused .md-tf-active-indicator {
                height: 3px;
                background: var(--m3-color-error, #b3261e);
            }
            .md-tf-label-filled {
                color: var(--m3-color-error, #b3261e);
            }

            // Error + hover
            &:not(.focused):not(.disabled) .md-tf-field:hover {
                .md-tf-active-indicator {
                    background: var(--m3-color-on-error-container, #410e0b);
                }
                .md-tf-state-layer {
                    opacity: 0.08;
                }
            }
        }

        // Disabled
        &.disabled {
            .md-tf-active-indicator {
                background: var(--m3-color-on-surface, #1d1b20);
                opacity: 0.38;
            }
            .md-tf-label-filled {
                color: var(--m3-color-on-surface, #1d1b20);
                opacity: 0.38;
            }
        }

        &.has-label .md-tf-content { padding-top: 8px; }
        &.has-label .md-tf-input { padding-top: 16px; }
    }

    // ═════════════════════════════════════════════════════════════════════════
    // TEXTAREA
    // ═════════════════════════════════════════════════════════════════════════
    &.textarea .md-tf-field {
        min-height: auto;
        resize: inherit;
    }

    // ═════════════════════════════════════════════════════════════════════════
    // LIQUID GLASS VARIANT
    // ═════════════════════════════════════════════════════════════════════════
    &.glass {
        &.outlined .md-tf-field {
            background: var(--glass-tint, rgba(255, 255, 255, 0.45));
            backdrop-filter: blur(var(--glass-blur, 20px));
            -webkit-backdrop-filter: blur(var(--glass-blur, 20px));
            border-radius: var(--m3-shape-medium, 12px);
        }

        &.outlined {
            .md-tf-outline-start,
            .md-tf-outline-notch,
            .md-tf-outline-end {
                border-color: var(--glass-border, rgba(255, 255, 255, 0.3));
            }
            &.focused {
                .md-tf-outline-start,
                .md-tf-outline-end {
                    border-color: var(--m3-color-primary, #6750a4);
                }
            }
        }

        &.filled .md-tf-field {
            background: var(--glass-tint, rgba(255, 255, 255, 0.35));
            backdrop-filter: blur(var(--glass-blur, 20px));
            -webkit-backdrop-filter: blur(var(--glass-blur, 20px));
            border-radius: var(--m3-shape-medium, 12px) var(--m3-shape-medium, 12px) 0 0;
        }

        .md-tf-input {
            color: var(--glass-on-surface, var(--m3-color-on-surface, #1d1b20));
        }
    }
}

// ═════════════════════════════════════════════════════════════════════════════
// FIELD CONTAINER
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-field {
    position: relative;
    display: flex;
    align-items: center;
    min-height: 56px;
    cursor: text;
    width: 100%;
    box-sizing: border-box;
}

.md-textfield.disabled .md-tf-field {
    cursor: default;
}

// ═════════════════════════════════════════════════════════════════════════════
// OUTLINE BORDER SEGMENTS (outlined variant)
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-outline {
    position: absolute;
    inset: 0;
    pointer-events: none;
    display: flex;
    border-radius: inherit;
    box-sizing: border-box;
}

.md-tf-outline-start,
.md-tf-outline-notch,
.md-tf-outline-end {
    box-sizing: border-box;
    transition: border-color $_duration $_easing,
                border-width 100ms $_easing;
}

.md-tf-outline-start {
    width: 12px;
    border-radius: var(--m3-shape-extra-small, 4px) 0 0 var(--m3-shape-extra-small, 4px);
    border-left: 1px solid var(--m3-color-outline, #79747e);
    border-top: 1px solid var(--m3-color-outline, #79747e);
    border-bottom: 1px solid var(--m3-color-outline, #79747e);
    margin-right: -1px;
}

.md-tf-outline-notch {
    position: relative;
    display: flex;
    align-items: center;
    max-width: calc(100% - 24px);
    border-top: 1px solid var(--m3-color-outline, #79747e);
    border-bottom: 1px solid var(--m3-color-outline, #79747e);
    padding: 0;
}

.md-tf-outline-end {
    flex: 1;
    border-radius: 0 var(--m3-shape-extra-small, 4px) var(--m3-shape-extra-small, 4px) 0;
    border-right: 1px solid var(--m3-color-outline, #79747e);
    border-top: 1px solid var(--m3-color-outline, #79747e);
    border-bottom: 1px solid var(--m3-color-outline, #79747e);
    margin-left: -1px;
}

// ═════════════════════════════════════════════════════════════════════════════
// ACTIVE INDICATOR (filled bottom line)
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-active-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--m3-color-on-surface-variant, #49454f);
    transition: height $_duration $_easing,
                background $_duration $_easing;
    pointer-events: none;
}

// ═════════════════════════════════════════════════════════════════════════════
// STATE LAYER (filled hover)
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-state-layer {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    opacity: 0;
    background: var(--m3-color-on-surface, #1d1b20);
    transition: opacity $_duration $_easing;
}

// ═════════════════════════════════════════════════════════════════════════════
// CONTENT WRAPPER
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-content {
    display: flex;
    flex: 1;
    align-items: center;
    padding: 0 16px;
    position: relative;
    z-index: 1;
    min-height: 56px;
}

// ═════════════════════════════════════════════════════════════════════════════
// LABELS
// ═════════════════════════════════════════════════════════════════════════════

// Outlined label
.md-tf-label-outlined {
    display: block;
    font-size: var(--m3-typescale-body-large-size, 1rem);
    line-height: var(--m3-typescale-body-large-line-height, 1.5rem);
    font-weight: var(--m3-typescale-body-large-weight, 400);
    color: var(--m3-color-on-surface-variant, #49454f);
    white-space: nowrap;
    pointer-events: none;
    padding: 0 4px;
    transform: translateY(0);
    transform-origin: left top;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: font-size $_duration $_easing,
                line-height $_duration $_easing,
                transform $_duration $_easing,
                color $_duration $_easing;
}

// Filled label
.md-tf-label-filled {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: var(--m3-typescale-body-large-size, 1rem);
    line-height: var(--m3-typescale-body-large-line-height, 1.5rem);
    font-weight: var(--m3-typescale-body-large-weight, 400);
    color: var(--m3-color-on-surface-variant, #49454f);
    pointer-events: none;
    max-width: calc(100% - 32px);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    transition: top $_duration $_easing,
                transform $_duration $_easing,
                font-size $_duration $_easing,
                line-height $_duration $_easing,
                color $_duration $_easing;

    &.has-leading {
        left: 52px;
        max-width: calc(100% - 68px);
    }
}

// ═════════════════════════════════════════════════════════════════════════════
// INPUT
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-input {
    flex: 1;
    border: none;
    background: transparent;
    outline: none;
    font-family: inherit;
    font-size: var(--m3-typescale-body-large-size, 1rem);
    line-height: var(--m3-typescale-body-large-line-height, 1.5rem);
    font-weight: var(--m3-typescale-body-large-weight, 400);
    color: var(--m3-color-on-surface, #1d1b20);
    min-width: 0;
    width: 100%;
    padding: 0;
    caret-color: var(--m3-color-primary, #6750a4);
    overflow-x: hidden;
    text-align: inherit;
    -webkit-tap-highlight-color: transparent;

    &:focus,
    &:focus-visible,
    &:focus-within {
        outline: none;
        border: none;
        box-shadow: none;
    }

    &:-webkit-autofill {
        animation-name: md-tf-autofill-start;
    }

    &:not(:-webkit-autofill) {
        animation-name: md-tf-autofill-cancel;
    }

    &::placeholder {
        color: var(--m3-color-on-surface-variant, #49454f);
        opacity: 1;
    }

    // Hide native date/search pickers
    &::-webkit-calendar-picker-indicator { display: none; }
    &::-webkit-search-decoration,
    &::-webkit-search-cancel-button { display: none; }

    &:disabled {
        color: var(--m3-color-on-surface, #1d1b20);
        opacity: 0.38;
        -webkit-text-fill-color: currentColor;
        cursor: default;
    }

    // Textarea
    &.textarea {
        resize: vertical;
        min-height: 48px;
    }
}

// Focus caret
.md-textfield.focused .md-tf-input {
    caret-color: var(--m3-color-primary, #6750a4);
}
.md-textfield.error.focused .md-tf-input {
    caret-color: var(--m3-color-error, #b3261e);
}

// ═════════════════════════════════════════════════════════════════════════════
// INPUT WRAPPER
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-input-wrapper {
    display: flex;
    flex: 1;
    align-items: center;
    min-width: 0;
}

// ═════════════════════════════════════════════════════════════════════════════
// ICONS
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    fill: currentColor;
    width: 24px;
    height: 24px;
    font-size: 24px;
    color: var(--m3-color-on-surface-variant, #49454f);
    flex-shrink: 0;
    position: relative;

    &.leading {
        margin-inline-end: 16px;
    }

    &.trailing {
        margin-inline-start: 16px;
    }
}

// ═════════════════════════════════════════════════════════════════════════════
// PREFIX / SUFFIX
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-prefix,
.md-tf-suffix {
    font-size: var(--m3-typescale-body-large-size, 1rem);
    line-height: var(--m3-typescale-body-large-line-height, 1.5rem);
    font-weight: var(--m3-typescale-body-large-weight, 400);
    color: var(--m3-color-on-surface-variant, #49454f);
    white-space: nowrap;
    width: min-content;
    opacity: 0;
    transition: opacity 100ms $_easing;
}

.md-tf-prefix {
    padding-inline-end: 2px;
}

.md-tf-suffix {
    padding-inline-start: 2px;
}

// ═════════════════════════════════════════════════════════════════════════════
// SUPPORTING TEXT
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-supporting {
    display: flex;
    justify-content: space-between;
    padding: 4px 16px 0;
    font-size: var(--m3-typescale-body-small-size, 0.75rem);
    line-height: var(--m3-typescale-body-small-line-height, 1rem);
    font-weight: var(--m3-typescale-body-small-weight, 400);
    color: var(--m3-color-on-surface-variant, #49454f);
    gap: 16px;
}

.md-tf-supporting-text {
    flex: 1;
}

.md-tf-counter {
    flex-shrink: 0;
    white-space: nowrap;
}

// ═════════════════════════════════════════════════════════════════════════════
// RIPPLE WRAPPER (filled only)
// ═════════════════════════════════════════════════════════════════════════════
.md-tf-ripple-wrapper {
    position: absolute;
    inset: 0;
    overflow: hidden;
    border-radius: inherit;
    pointer-events: none;
}

// ═════════════════════════════════════════════════════════════════════════════
// FORCED-COLORS (High-Contrast Mode)
// ═════════════════════════════════════════════════════════════════════════════
@media (forced-colors: active) {
    .md-tf-input {
        background: none;
    }

    .md-tf-outline-start,
    .md-tf-outline-notch,
    .md-tf-outline-end {
        border-color: CanvasText;
    }

    .md-tf-active-indicator {
        background: CanvasText;
    }

    .md-textfield.focused {
        .md-tf-outline-start,
        .md-tf-outline-notch,
        .md-tf-outline-end {
            border-color: Highlight;
        }
        .md-tf-active-indicator {
            background: Highlight;
        }
    }

    .md-textfield.disabled {
        .md-tf-outline-start,
        .md-tf-outline-notch,
        .md-tf-outline-end {
            border-color: GrayText;
            opacity: 1;
        }
        .md-tf-active-indicator {
            background: GrayText;
            opacity: 1;
        }
        .md-tf-input {
            color: GrayText;
            opacity: 1;
        }
        .md-tf-label-outlined,
        .md-tf-label-filled {
            color: GrayText;
            opacity: 1;
        }
    }
}
