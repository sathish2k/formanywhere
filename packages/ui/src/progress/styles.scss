/* ═══════════════════════════════════════════════════════════════════════════════
   M3 PROGRESS - Based on material-components/material-web
   Circular & Linear progress indicators
   ═══════════════════════════════════════════════════════════════════════════════ */

/* ─── Keyframes: Circular ──────────────────────────────────────────────────── */

// Outer container continuous rotation (M3 spec: 1568ms period)
@keyframes md-circular-rotate {
  to {
    transform: rotate(360deg);
  }
}

// Stroke dash expansion/contraction for SVG indeterminate
@keyframes md-circular-dash {
  0% {
    stroke-dasharray: 1, 200;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 89, 200;
    stroke-dashoffset: -35;
  }
  100% {
    stroke-dasharray: 89, 200;
    stroke-dashoffset: -124;
  }
}

/* ─── Keyframes: Linear ────────────────────────────────────────────────────── */

// Primary bar translate for indeterminate (M3 spec)
@keyframes md-linear-primary-translate {
  0% {
    transform: translateX(0);
  }
  20% {
    animation-timing-function: cubic-bezier(0.5, 0, 0.701732, 0.495819);
    transform: translateX(0);
  }
  59.15% {
    animation-timing-function: cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);
    transform: translateX(83.6714%);
  }
  100% {
    transform: translateX(200.611%);
  }
}

// Primary bar scale for indeterminate (M3 spec)
@keyframes md-linear-primary-scale {
  0% {
    transform: scaleX(0.08);
  }
  36.65% {
    animation-timing-function: cubic-bezier(0.334731, 0.12482, 0.785844, 1);
    transform: scaleX(0.08);
  }
  69.15% {
    animation-timing-function: cubic-bezier(0.06, 0.11, 0.6, 1);
    transform: scaleX(0.661479);
  }
  100% {
    transform: scaleX(0.08);
  }
}

// Single-bar fallback for our TSX structure (combined translate + scale)
@keyframes md-linear-indeterminate {
  0% {
    transform: translateX(-100%) scaleX(0.3);
  }
  20% {
    animation-timing-function: cubic-bezier(0.5, 0, 0.701732, 0.495819);
    transform: translateX(-60%) scaleX(0.08);
  }
  59.15% {
    animation-timing-function: cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);
    transform: translateX(20%) scaleX(0.66);
  }
  100% {
    transform: translateX(100%) scaleX(0.08);
  }
}

/* ─── CIRCULAR PROGRESS ────────────────────────────────────────────────────── */

.md-circular-progress {
  display: inline-flex;
  vertical-align: middle;
  position: relative;
  align-items: center;
  justify-content: center;
  contain: strict;
  content-visibility: auto;
  // M3: 4px padding around the progress ring
  padding: 4px;

  svg {
    transform: rotate(-90deg);
  }

  // ── Determinate → Indeterminate transition ──
  &.indeterminate svg {
    animation: md-circular-rotate 1568ms linear infinite;
    transform: rotate(0deg); // interpolatable base (not none)
  }

  &.indeterminate .md-circular-progress__indicator {
    animation: md-circular-dash 1333ms ease-in-out infinite;
    stroke-linecap: round;
  }

  // ── Glass variant ──
  &.glass .md-circular-progress__track {
    stroke: var(--glass-tint, rgba(255, 255, 255, 0.25));
  }

  &.glass .md-circular-progress__indicator {
    stroke: var(--m3-color-primary, rgba(103, 80, 164, 0.9));
  }

  // ── Size variants ──
  &.small {
    width: 24px;
    height: 24px;
  }

  &.medium {
    width: 48px;
    height: 48px;
  }

  &.large {
    width: 64px;
    height: 64px;
  }

  // ── Disabled state ──
  &[aria-disabled='true'],
  &.disabled {
    opacity: 0.38;
    cursor: default;
  }
}

.md-circular-progress__track {
  fill: none;
  stroke: transparent;
}

.md-circular-progress__indicator {
  fill: none;
  stroke: var(--m3-color-primary, #6750a4);
  stroke-linecap: round;
  transition: stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1);
}

/* ─── LINEAR PROGRESS ──────────────────────────────────────────────────────── */

.md-linear-progress {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  height: var(--m3-linear-progress-track-height, 4px);
  min-width: 80px;
  border-radius: var(--m3-linear-progress-track-shape, 0px);
  background: var(--m3-color-surface-container-highest, #e6e0e9);
  overflow: hidden;
  contain: strict;
  content-visibility: auto;

  // ── Glass variant ──
  &.glass {
    background: var(--glass-tint, rgba(255, 255, 255, 0.3));
    backdrop-filter: blur(var(--glass-blur, 12px));
    -webkit-backdrop-filter: blur(var(--glass-blur, 12px));
    border: 1px solid var(--glass-border, rgba(255, 255, 255, 0.2));
    height: 6px;
    border-radius: var(--m3-shape-full, 3px);

    .md-linear-progress__indicator {
      background: var(--m3-color-primary, rgba(103, 80, 164, 0.85));
      border-radius: var(--m3-shape-full, 3px);
    }

    .md-linear-progress__indeterminate {
      background: var(--m3-color-primary, rgba(103, 80, 164, 0.85));
      border-radius: var(--m3-shape-full, 3px);
    }
  }

  // ── Rounded variant ──
  &.rounded {
    border-radius: var(--m3-shape-full, 2px);

    .md-linear-progress__indicator,
    .md-linear-progress__buffer,
    .md-linear-progress__indeterminate {
      border-radius: var(--m3-shape-full, 2px);
    }
  }

  // ── Disabled state ──
  &[aria-disabled='true'],
  &.disabled {
    opacity: 0.38;
    cursor: default;
  }
}

.md-linear-progress__indicator {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: var(--m3-color-primary, #6750a4);
  border-radius: inherit;
  transform-origin: left center;
  transition: width 250ms cubic-bezier(0.4, 0, 0.6, 1);
}

.md-linear-progress__buffer {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: var(--m3-color-primary-container, #eaddff);
  opacity: 0.4;
  border-radius: inherit;
  transform-origin: left center;
  transition: width 250ms cubic-bezier(0.4, 0, 0.6, 1);
}

.md-linear-progress__indeterminate {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  background: var(--m3-color-primary, #6750a4);
  border-radius: inherit;
  transform-origin: left center;
  animation: md-linear-indeterminate 2s linear infinite;
}

/* ─── FORCED-COLORS (HIGH CONTRAST) ────────────────────────────────────────── */

@media (forced-colors: active) {
  .md-circular-progress__indicator {
    stroke: CanvasText;
  }

  .md-circular-progress__track {
    stroke: GrayText;
  }

  .md-linear-progress {
    outline: 1px solid CanvasText;
  }

  .md-linear-progress__indicator,
  .md-linear-progress__indeterminate {
    background-color: CanvasText;
  }

  .md-linear-progress__buffer {
    background-color: GrayText;
  }
}
